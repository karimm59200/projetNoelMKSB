<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous">
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="./inscription.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Inscription</title>
</head>
<body>
    <main>
      <header>
        <p id="countdown"></p>
      </header>
      <!-- SNOW -->
       <div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       <div class="snowflake"></div>
       </div>
       <!-- SNOW -->
        <!-- RECUPERE LE FORM DU PHP AVEC UN FETCH pour ajouter un pseudo a la list-->
        

        <!-- FORM SAMUEL -->
        <div class="d-flex justify-content-center" id="div-form-inscription">
          <div id="form" class="col-7 m-3">
            <h3 class="text-center mb-3">Inscrivez-vous</h3>
            <div class="form-group row">
              <label for="pseudo" class="col-sm-3 col-form-label">Pseudo :</label>
              <div class="col-sm-9">
                <input type="text" class="form-control" id="inputAjouter" placeholder="Entrer un pseudo">
              </div>
            </div> 
            <div class="d-flex justify-content-center mt-3">
              <button class="btn btn-primary" onclick="ajouter()" id="ajouterbtn">Ajouter</button>  
            </div>
          </div>
        </div>
        <div id="dejaInscrit">
          <p class="text-center">Déjà inscrit, <a href="./distribution.html">Cliquez ici !</a></p>
        </div>
        <!-- FORM SAMUEL -->


        <section id="section-list" class=""></section>
        <!-- <div id="pseudo"></div> -->
        
            <!-- BENOIT -->
            <div class="d-flex justify-content-center">
              <div class="btn-noel"><a href="./distribution.html" class="button-noel mt-4">C'est parti pour le tirage !</a></div> 
            </div>
            <!-- BENOIT -->
            
            <footer class="footer">
              <input class="btn btn-primary" type="button" value="Retour" id="retourarr" onclick="history.go(-1)">

              
              <div class="div-conteneur">
                <div class="conteneur">
                  <span>Thème 1 / Thème 2</span>
                  <input type="checkbox" class="checkbox" id="chk" />
                  <label class="label" for="chk">
                    <i class="fas fa-circle" id="circleBlue"></i>
                    <i class="fas fa-circle" id="circleRed"></i>
                    <div class="ball"></div>
                  </label>
                </div>
              </div>
              <div class="" id="retour">
                <a href="./index.html"><button class="btn btn-primary" id="btn-retour">Retour à la page d'acceuil</button></a>
              </div>
           
              
        </footer>
  </div>
    </main>
    <script>
       // new creation d'un objet XMLHttpRequest 
       const xhttp = new XMLHttpRequest();
        
        // je defini la fonction qui sera utilisé une fois les données chargées
        xhttp.onload = function() 
        {
            // console.log( this.responseText );
            let tableauData = JSON.parse( this.responseText );
            let chaine = "";

                for ( ligne of tableauData )
                    chaine += `<div class="p-2"> ${ligne['pseudo']}</div>`;

            //console.log( chaine );
            document.getElementById("section-list").innerHTML = chaine;
        }
        // je prépare l'appel de l'URL
        xhttp.open("POST", 'listeInscrit.php' );
        // j'envoie l'url
        xhttp.send();
      
// $("#inputAjouter").click(function()
//                    {
//                       let tableau = JSON.parse( 
//                           $("#section-list").load("listeInscrit.php"));
//                       let chaine = "<table>";
//                       for ( ligne of tableau )
//                       {
//                           chaine += "<tr><td>"+ligne['nom']+"</td></tr>";;
//                       }
//                       chaine += "</table>";
//                       $( "#section-list").text( chaine );
//                    }
//                 );

      // envoi données en back
      function ajouter()
    {
      if($('#inputAjouter').val() != "")
      {
        $.post("formulaireInscriptionNoel.php",
            {
                'pseudo' : $('#inputAjouter').val()
            },
            function(data,status)
            {
                     // new creation d'un objet XMLHttpRequest 
            const xhttp = new XMLHttpRequest();
              
              // je defini la fonction qui sera utilisé une fois les données chargées
              xhttp.onload = function() 
              {
                  // console.log( this.responseText );
                  let tableauData = JSON.parse( this.responseText );
                  let chaine = "";

                      for ( ligne of tableauData )
                          chaine += `<div class="p-2"> ${ligne['pseudo']}</div>`;

                  //console.log( chaine );
                  document.getElementById("section-list").innerHTML = chaine;
              }
              // je prépare l'appel de l'URL
              xhttp.open("POST", 'listeInscrit.php' );
              // j'envoie l'url
              xhttp.send();
            }
        );


      }

      else
        alert("Champ vide !!!");
    } 

      // fetch récupère la liste des inscrits
      // fetch("./listeInscrit.php")
			// 	.then(function (result) {
			// 		if (result.status === 200) {
			// 			return result.json();
			// 		}
			// 	}).then(function (value) {
      //     let list = value;
					
      //     list.forEach(v => {
      //       // console.log(v.pseudo);

      //       create(v.pseudo)
      //       });
			// 	}).catch(function (error) {
			// 		console.log(error);
			// 	});

        // function create(pseudo) {
        //     let div = document.createElement('div');
        //     div.innerHTML = `<div>${pseudo}</div>`
        //     document.querySelector('#pseudo').appendChild(div);
        // }

        
        // fetch récupère le formulaire d'inscription

        // fetch("./formulaireInscriptionNoel.php")
				// .then(function (result) {
				// 	if (result.status === 200) {
				// 		return result.json();
				// 	}
				// }).then(function (value) {
        //   let form = value;
				// }).catch(function (error) {
        //   console.log(error);
				// });
    </script>
    <script src="script.js"></script>
    <script src="theme.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>
</html>